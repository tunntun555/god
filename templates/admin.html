{% extends "layout.html" %}

{% block title %}‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö - Photo Booth Admin{% endblock %}

{% block content %}
<div class="admin-page">
    <!-- Header -->
    <div class="admin-header">
        <h1><i class="fas fa-cog"></i> Photo Booth Admin</h1>
        <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå</p>
        <div class="server-info">
            <span><i class="fas fa-server"></i> us1.bot-hosting.net:21555</span>
            <span><i class="fas fa-clock"></i> <span id="serverTime">‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤...</span></span>
        </div>
    </div>

    <!-- System Status -->
    <div class="system-status">
        <h2><i class="fas fa-heartbeat"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <div class="status-grid">
            <div class="status-card online">
                <i class="fas fa-plug"></i>
                <h3>‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</h3>
                <div class="status-text">ONLINE</div>
            </div>
            <div class="status-card {% if camera_locked %}locked{% else %}unlocked{% endif %}">
                <i class="fas fa-camera"></i>
                <h3>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</h3>
                <div class="status-text">
                    {% if camera_locked %}
                    LOCKED
                    {% else %}
                    UNLOCKED
                    {% endif %}
                </div>
            </div>
            <div class="status-card active">
                <i class="fas fa-qrcode"></i>
                <h3>QR Display</h3>
                <div class="status-text">ACTIVE</div>
            </div>
            <div class="status-card normal">
                <i class="fas fa-database"></i>
                <h3>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <div class="status-text">NORMAL</div>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-camera"></i>
            </div>
            <div class="stat-content">
                <h3>‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <div class="stat-number">{{ stats.total_photos }}</div>
                <div class="stat-sub">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-download"></i>
            </div>
            <div class="stat-content">
                <h3>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</h3>
                <div class="stat-number">{{ stats.total_downloads }}</div>
                <div class="stat-sub">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô</h3>
                <div class="stat-number">{{ stats.total_sessions }}</div>
                <div class="stat-sub">‡∏Ñ‡∏ô</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-redo"></i>
            </div>
            <div class="stat-content">
                <h3>‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h3>
                <div class="stat-number">{{ stats.retake_used if stats.retake_used else 0 }}</div>
                <div class="stat-sub">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
            </div>
        </div>
    </div>

    <!-- Camera Control Section -->
    <div class="control-section">
        <div class="section-header">
            <h2><i class="fas fa-gamepad"></i> ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
        </div>
        
        <div class="control-grid">
            <!-- Camera Lock Control -->
            <div class="control-card">
                <h3><i class="fas fa-lock"></i> ‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</h3>
                <div class="control-status">
                    {% if camera_locked %}
                    <div class="status-badge locked">
                        <i class="fas fa-lock"></i> ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ
                    </div>
                    <div class="status-info">
                        <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Ñ:</strong> {{ locked_by_code }}</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ</p>
                    </div>
                    <div class="control-buttons">
                        <button onclick="unlockCamera()" class="btn btn-unlock">
                            <i class="fas fa-unlock"></i> ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                        </button>
                        <button onclick="forceUnlock()" class="btn btn-warning">
                            <i class="fas fa-bolt"></i> ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        </button>
                    </div>
                    {% else %}
                    <div class="status-badge unlocked">
                        <i class="fas fa-unlock"></i> ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ
                    </div>
                    <div class="status-info">
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                        <p><strong>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ</p>
                    </div>
                    <div class="control-buttons">
                        <button onclick="lockCameraTest()" class="btn btn-test">
                            <i class="fas fa-vial"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Ñ
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- QR Control -->
            <div class="control-card">
                <h3><i class="fas fa-qrcode"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div class="control-status">
                    {% if latest_qr and latest_qr.qr_image %}
                    <div class="qr-preview-small">
                        <img src="{{ latest_qr.qr_image }}" alt="QR Code" width="120">
                    </div>
                    <div class="status-info">
                        <p><strong>‡∏£‡∏´‡∏±‡∏™:</strong> {{ latest_qr.code }}</p>
                        <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> {{ latest_qr.time_display }}</p>
                    </div>
                    <div class="control-buttons">
                        <button onclick="clearQR()" class="btn btn-danger">
                            <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á QR
                        </button>
                        <button onclick="viewQR('{{ latest_qr.code }}')" class="btn btn-secondary">
                            <i class="fas fa-eye"></i> ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á
                        </button>
                    </div>
                    {% else %}
                    <div class="status-info empty">
                        <p><i class="fas fa-qrcode fa-2x"></i></p>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ QR ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                    <div class="control-buttons">
                        <button onclick="createTestQR()" class="btn btn-test">
                            <i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- System Control -->
            <div class="control-card">
                <h3><i class="fas fa-sliders-h"></i> ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div class="control-status">
                    <div class="setting-item">
                        <label><i class="fas fa-camera"></i> ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà:</label>
                        <select id="retakeLimit" class="setting-select">
                            <option value="1" selected>1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                            <option value="0">‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</option>
                            <option value="2">2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label><i class="fas fa-image"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</label>
                        <select id="maxPhotos" class="setting-select">
                            <option value="1">1 ‡∏£‡∏π‡∏õ</option>
                            <option value="2">2 ‡∏£‡∏π‡∏õ</option>
                            <option value="3">3 ‡∏£‡∏π‡∏õ</option>
                            <option value="4" selected>4 ‡∏£‡∏π‡∏õ</option>
                        </select>
                    </div>
                    <div class="control-buttons">
                        <button onclick="saveSettings()" class="btn btn-primary">
                            <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                        <button onclick="resetSettings()" class="btn">
                            <i class="fas fa-undo"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== FRAME MANAGEMENT SECTION ==================== -->
    <div class="frame-management-section">
        <div class="section-header">
            <h2><i class="fas fa-border-all"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ</h2>
            <div class="section-actions">
                <button onclick="openFrameBuilder()" class="btn btn-primary">
                    <i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
                </button>
                <button onclick="loadFrames()" class="btn btn-refresh">
                    <i class="fas fa-sync"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
        </div>
        
        <div class="frames-grid" id="framesGrid">
            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡πÇ‡∏î‡∏¢ JavaScript ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            <div class="loading-frames">
                <i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏ö...
            </div>
        </div>
    </div>

    <!-- Photos List -->
    <div class="photos-section">
        <div class="section-header">
            <h2><i class="fas fa-images"></i> ‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ photos|length if photos else 0 }} ‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô)</h2>
            <div class="section-actions">
                <button onclick="exportAllData()" class="btn btn-export">
                    <i class="fas fa-file-export"></i> Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button onclick="refreshData()" class="btn btn-refresh">
                    <i class="fas fa-sync"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
        </div>
        
        {% if photos and photos|length > 0 %}
        <div class="table-container">
            <table class="photos-table">
                <thead>
                    <tr>
                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                        <th>‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏£‡∏π‡∏õ</th>
                        <th>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</th>
                        <th>‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</th>
                        <th>‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for photo in photos %}
                    <tr>
                        <td>
                            <div class="code-cell">
                                <code>{{ photo.pickup_code }}</code>
                                <button onclick="copyCode('{{ photo.pickup_code }}')" class="copy-btn" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                        </td>
                        <td>
                            {% if photo.filenames and photo.filenames|length > 0 %}
                            <div class="thumbnail-container">
                                <img src="{{ url_for('get_photo', filename=photo.filenames[0]) }}" 
                                     class="thumbnail" 
                                     alt="Thumbnail"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIGZpbGw9IiNlMmU4ZjAiLz48dGV4dCB4PSIzMCIgeT0iMzAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzdFODA5NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='">
                                <div class="thumbnail-overlay">
                                    <span>{{ photo.filenames|length }}</span>
                                </div>
                            </div>
                            {% else %}
                            <div class="no-thumb">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>
                            {% endif %}
                        </td>
                        <td>
                            <div class="time-cell">
                                <div class="time-main">{{ photo.time_display if photo.time_display else 'N/A' }}</div>
                                <div class="time-sub">{{ photo.timestamp[:10] if photo.timestamp else '' }}</div>
                            </div>
                        </td>
                        <td>
                            <span class="badge count-badge">{{ photo.filenames|length if photo.filenames else 0 }}</span>
                        </td>
                        <td>
                            <span class="badge download-badge">{{ photo.download_count if photo.download_count else 0 }}</span>
                        </td>
                        <td>
                            {% if photo.retake_used %}
                            <span class="badge retake-badge used">
                                <i class="fas fa-check"></i> ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß
                            </span>
                            {% else %}
                            <span class="badge retake-badge available">
                                <i class="fas fa-times"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if photo.template_id %}
                            <span class="badge frame-badge">
                                <i class="fas fa-border-all"></i> {{ photo.template_id[:6] }}...
                            </span>
                            {% elif photo.is_composite %}
                            <span class="badge frame-badge">
                                <i class="fas fa-border-all"></i> ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏ö
                            </span>
                            {% else %}
                            <span class="badge no-frame-badge">
                                <i class="fas fa-times"></i> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="deletePhoto('{{ photo.id }}')" 
                                        class="btn-action btn-delete" title="‡∏•‡∏ö‡∏£‡∏π‡∏õ">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <a href="/download/{{ photo.pickup_code }}" 
                                   target="_blank" 
                                   class="btn-action btn-view" title="‡∏î‡∏π‡∏£‡∏π‡∏õ">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="/scan/{{ photo.pickup_code }}" 
                                   target="_blank" 
                                   class="btn-action btn-scan" title="‡∏™‡πÅ‡∏Å‡∏ô QR">
                                    <i class="fas fa-qrcode"></i>
                                </a>
                                <button onclick="downloadPhotoZip('{{ photo.pickup_code }}')" 
                                        class="btn-action btn-download" title="‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ZIP">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="table-footer">
            <div class="pagination-info">
                ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ photos|length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </div>
            <div class="table-actions">
                <button onclick="clearAllPhotos()" class="btn btn-danger btn-sm">
                    <i class="fas fa-broom"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button onclick="backupPhotos()" class="btn btn-secondary btn-sm">
                    <i class="fas fa-save"></i> Backup
                </button>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-images fa-3x"></i>
            </div>
            <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <p>‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ <a href="/capture">Camera</a> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å</p>
            <button onclick="createSampleData()" class="btn btn-test">
                <i class="fas fa-magic"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            </button>
        </div>
        {% endif %}
    </div>

    <!-- System Information -->
    <div class="system-info-section">
        <div class="section-header">
            <h2><i class="fas fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
        </div>
        
        <div class="info-grid">
            <div class="info-card">
                <h3><i class="fas fa-link"></i> ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div class="info-links">
                    <a href="/capture" target="_blank" class="info-link">
                        <i class="fas fa-camera"></i> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
                        <span>/capture</span>
                    </a>
                    <a href="/qr" target="_blank" class="info-link">
                        <i class="fas fa-qrcode"></i> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á QR
                        <span>/qr</span>
                    </a>
                    <a href="/admin" class="info-link">
                        <i class="fas fa-cog"></i> ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                        <span>/admin</span>
                    </a>
                    <a href="/api/full_status" target="_blank" class="info-link">
                        <i class="fas fa-heartbeat"></i> API Status
                        <span>/api/full_status</span>
                    </a>
                    <a href="/api/frame_templates" target="_blank" class="info-link">
                        <i class="fas fa-border-all"></i> API ‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ
                        <span>/api/frame_templates</span>
                    </a>
                </div>
            </div>
            
            <div class="info-card">
                <h3><i class="fas fa-chart-line"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div class="system-stats">
                    <div class="system-stat">
                        <span>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</span>
                        <span id="lastUploadTime">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                    </div>
                    <div class="system-stat">
                        <span>QR ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</span>
                        <span id="lastQRTime">{{ latest_qr.time_display if latest_qr else 'N/A' }}</span>
                    </div>
                    <div class="system-stat">
                        <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡πâ‡∏≠‡∏á:</span>
                        <span id="cameraStatusLive" class="status-indicator {% if camera_locked %}locked{% else %}unlocked{% endif %}">
                            {% if camera_locked %}
                            <i class="fas fa-lock"></i> ‡∏•‡πá‡∏≠‡∏Ñ
                            {% else %}
                            <i class="fas fa-unlock"></i> ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ
                            {% endif %}
                        </span>
                    </div>
                    <div class="system-stat">
                        <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</span>
                        <span id="currentTime">--:--:--</span>
                    </div>
                    <div class="system-stat">
                        <span>‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ:</span>
                        <span id="frameCount">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                    </div>
                </div>
            </div>
            
            <div class="info-card">
                <h3><i class="fas fa-tools"></i> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div class="tool-buttons">
                    <button onclick="restartCamera()" class="btn-tool">
                        <i class="fas fa-redo"></i> ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏Å‡∏•‡πâ‡∏≠‡∏á
                    </button>
                    <button onclick="clearCache()" class="btn-tool">
                        <i class="fas fa-broom"></i> ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä
                    </button>
                    <button onclick="checkMemoryStatus()" class="btn-tool">
                        <i class="fas fa-microchip"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ RAM
                    </button>
                    <button onclick="systemDiagnostic()" class="btn-tool">
                        <i class="fas fa-stethoscope"></i> ‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                    <button onclick="viewLogs()" class="btn-tool">
                        <i class="fas fa-file-alt"></i> ‡∏î‡∏π Logs
                    </button>
                    <button onclick="emergencyUnlock()" class="btn-tool btn-emergency">
                        <i class="fas fa-exclamation-triangle"></i> ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h3><i class="fas fa-bolt"></i> ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h3>
        <div class="action-buttons-grid">
            <button onclick="quickUnlock()" class="btn-quick-action">
                <i class="fas fa-unlock"></i>
                <span>‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</span>
            </button>
            <button onclick="quickClearQR()" class="btn-quick-action">
                <i class="fas fa-trash"></i>
                <span>‡∏•‡πâ‡∏≤‡∏á QR</span>
            </button>
            <button onclick="quickRefresh()" class="btn-quick-action">
                <i class="fas fa-sync"></i>
                <span>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤</span>
            </button>
            <button onclick="quickStats()" class="btn-quick-action">
                <i class="fas fa-chart-bar"></i>
                <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span>
            </button>
            <button onclick="quickBackup()" class="btn-quick-action">
                <i class="fas fa-save"></i>
                <span>Backup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
            </button>
            <button onclick="quickTest()" class="btn-quick-action">
                <i class="fas fa-vial"></i>
                <span>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</span>
            </button>
            <button onclick="openFrameBuilder()" class="btn-quick-action">
                <i class="fas fa-border-all"></i>
                <span>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö</span>
            </button>
            <button onclick="checkMemoryStatus()" class="btn-quick-action">
                <i class="fas fa-microchip"></i>
                <span>RAM Status</span>
            </button>
        </div>
    </div>
</div>

<!-- ==================== FRAME BUILDER MODAL ==================== -->
<div id="frameBuilderModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 1400px;">
        <div class="modal-header">
            <h2>üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ</h2>
            <button class="close" onclick="closeFrameBuilder()">&times;</button>
        </div>
        
        <div class="frame-builder-container">
            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ã‡πâ‡∏≤‡∏¢: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
            <div class="frame-settings">
                <h3>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏ö</h3>
                
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏ö:</label>
                    <input type="text" id="frameName" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Å‡∏£‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô">
                </div>
                
                <div class="form-group">
                    <label>‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á:</label>
                    <select id="frameOrientation" onchange="updateCanvasSize()">
                        <option value="vertical">‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á (Portrait)</option>
                        <option value="horizontal">‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (Landscape)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>‡∏Ç‡∏ô‡∏≤‡∏î Canvas:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="canvasWidth" value="1200" placeholder="Width" style="width: 100px;">
                        <span>√ó</span>
                        <input type="number" id="canvasHeight" value="1800" placeholder="Height" style="width: 100px;">
                        <span>px</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏£‡∏π‡∏õ‡∏Å‡∏£‡∏≠‡∏ö (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á):</label>
                    <input type="file" id="frameImageInput" accept="image/*" onchange="loadFrameImage(event)">
                    <small style="color: #999; display: block; margin-top: 5px;">*‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß</small>
                </div>
                
                <hr style="margin: 20px 0; border-color: rgba(255,255,255,0.1);">
                
                <h4>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á 4 ‡∏£‡∏π‡∏õ</h4>
                <p style="font-size: 0.9rem; color: #999; margin-bottom: 15px;">
                    ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏Å‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                </p>
                
                <div id="positionsList">
                    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á 4 ‡∏£‡∏π‡∏õ -->
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="resetPositions()" class="btn" style="flex: 1;">
                        <i class="fas fa-undo"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                    </button>
                    <button onclick="autoArrangePositions()" class="btn btn-secondary" style="flex: 1;">
                        <i class="fas fa-magic"></i> ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    </button>
                </div>
                
                <button onclick="saveFrameTemplate()" class="btn btn-success" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏£‡∏≠‡∏ö
                </button>
            </div>
            
            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏ß‡∏≤: ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á -->
            <div class="frame-preview-area">
                <h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h3>
                <div class="canvas-container" style="position: relative; width: fit-content; margin: 0 auto;">
                    <canvas id="frameCanvas" width="1200" height="1800"></canvas>
                    <div id="positionMarkers" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <small style="color: #999;">üñ±Ô∏è ‡∏•‡∏≤‡∏Å‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
<div id="infoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Modal Title</h3>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡πÇ‡∏î‡∏¢ JavaScript -->
        </div>
        <div class="modal-footer">
            <button onclick="closeModal()" class="btn">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

<style>
/* ============================================
   Frame Management Styles
============================================ */
.frame-management-section {
    background: white;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 3px 15px rgba(0,0,0,0.08);
}

.frames-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.frame-card {
    background: #f8f9fa;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
}

.frame-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.frame-card-preview {
    width: 100%;
    height: 200px;
    background: white;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
    overflow: hidden;
    border: 1px solid #e2e8f0;
}

.frame-card-preview img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.frame-card-preview i {
    font-size: 3rem;
    color: #a0aec0;
}

.frame-card h4 {
    color: #2d3748;
    margin-bottom: 10px;
    font-size: 1.2rem;
}

.frame-card-info {
    font-size: 0.85rem;
    color: #718096;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e2e8f0;
}

.frame-builder-container {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 30px;
    margin-top: 20px;
    max-height: 70vh;
    overflow-y: auto;
    padding: 10px;
}

.frame-settings {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.frame-settings h3,
.frame-preview-area h3 {
    color: #2d3748;
    margin-bottom: 20px;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #4a5568;
    font-weight: 600;
    font-size: 0.95rem;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #cbd5e0;
    background: white;
    color: #2d3748;
    font-size: 0.95rem;
    transition: all 0.3s;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#frameCanvas {
    display: block;
    max-width: 100%;
    height: auto;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
}

.position-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #e2e8f0;
}

.position-item label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 10px;
    display: block;
}

.position-inputs {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.position-inputs input {
    width: 100%;
    padding: 8px;
    border: 1px solid #cbd5e0;
    border-radius: 6px;
    font-size: 0.85rem;
}

.frame-badge {
    background: #e9d8fd;
    color: #553c9a;
}

.no-frame-badge {
    background: #e2e8f0;
    color: #4a5568;
}

.loading-frames {
    grid-column: 1 / -1;
    text-align: center;
    padding: 40px;
    color: #718096;
}

.loading-frames i {
    font-size: 2rem;
    margin-bottom: 15px;
}

/* Responsive */
@media (max-width: 1200px) {
    .frame-builder-container {
        grid-template-columns: 1fr;
        max-height: none;
    }
}

@media (max-width: 768px) {
    .frames-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// ============================================
// Frame Management Variables
// ============================================
let currentFrameImage = null;
let photoPositions = [
    {x: 100, y: 100, width: 1000, height: 750},
    {x: 100, y: 900, width: 480, height: 360},
    {x: 620, y: 900, width: 480, height: 360},
    {x: 100, y: 1310, width: 1000, height: 400}
];
let isDragging = false;
let currentDragIndex = -1;
let dragStartX = 0, dragStartY = 0;

// ============================================
// Frame Management Functions
// ============================================
function openFrameBuilder() {
    document.getElementById('frameBuilderModal').style.display = 'block';
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    photoPositions = [
        {x: 100, y: 100, width: 1000, height: 750},
        {x: 100, y: 900, width: 480, height: 360},
        {x: 620, y: 900, width: 480, height: 360},
        {x: 100, y: 1310, width: 1000, height: 400}
    ];
    document.getElementById('frameName').value = '';
    document.getElementById('frameImageInput').value = '';
    currentFrameImage = null;
    updateCanvas();
    renderPositionsList();
    initDragHandlers();
}

function closeFrameBuilder() {
    document.getElementById('frameBuilderModal').style.display = 'none';
}

function updateCanvasSize() {
    const orientation = document.getElementById('frameOrientation').value;
    const widthInput = document.getElementById('canvasWidth');
    const heightInput = document.getElementById('canvasHeight');
    
    if (orientation === 'vertical') {
        widthInput.value = 1200;
        heightInput.value = 1800;
    } else {
        widthInput.value = 1800;
        heightInput.value = 1200;
    }
    
    updateCanvas();
}

function loadFrameImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                currentFrameImage = img;
                updateCanvas();
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

function updateCanvas() {
    const canvas = document.getElementById('frameCanvas');
    const ctx = canvas.getContext('2d');
    
    const width = parseInt(document.getElementById('canvasWidth').value) || 1200;
    const height = parseInt(document.getElementById('canvasHeight').value) || 1800;
    
    canvas.width = width;
    canvas.height = height;
    
    // ‡∏•‡πâ‡∏≤‡∏á canvas
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, width, height);
    
    // ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏Å‡∏£‡∏≠‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    if (currentFrameImage) {
        ctx.drawImage(currentFrameImage, 0, 0, width, height);
    }
    
    // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏π‡∏õ
    ctx.strokeStyle = '#FF6B6B';
    ctx.lineWidth = 3;
    photoPositions.forEach((pos, i) => {
        ctx.strokeRect(pos.x, pos.y, pos.width, pos.height);
        ctx.fillStyle = 'rgba(255, 107, 107, 0.2)';
        ctx.fillRect(pos.x, pos.y, pos.width, pos.height);
        
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç
        ctx.fillStyle = '#FF6B6B';
        ctx.font = 'bold 40px Arial';
        ctx.fillText((i + 1).toString(), pos.x + 20, pos.y + 50);
    });
}

function renderPositionsList() {
    const container = document.getElementById('positionsList');
    container.innerHTML = '';
    
    photoPositions.forEach((pos, i) => {
        const item = document.createElement('div');
        item.className = 'position-item';
        item.innerHTML = `
            <label><strong>‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${i + 1}</strong></label>
            <div class="position-inputs">
                <input type="number" placeholder="X" value="${pos.x}" onchange="updatePosition(${i}, 'x', this.value)">
                <input type="number" placeholder="Y" value="${pos.y}" onchange="updatePosition(${i}, 'y', this.value)">
                <input type="number" placeholder="Width" value="${pos.width}" onchange="updatePosition(${i}, 'width', this.value)">
                <input type="number" placeholder="Height" value="${pos.height}" onchange="updatePosition(${i}, 'height', this.value)">
            </div>
        `;
        container.appendChild(item);
    });
}

function updatePosition(index, key, value) {
    photoPositions[index][key] = parseInt(value) || 0;
    updateCanvas();
}

function resetPositions() {
    photoPositions = [
        {x: 100, y: 100, width: 1000, height: 750},
        {x: 100, y: 900, width: 480, height: 360},
        {x: 620, y: 900, width: 480, height: 360},
        {x: 100, y: 1310, width: 1000, height: 400}
    ];
    updateCanvas();
    renderPositionsList();
}

function autoArrangePositions() {
    const width = parseInt(document.getElementById('canvasWidth').value) || 1200;
    const height = parseInt(document.getElementById('canvasHeight').value) || 1800;
    
    photoPositions = [
        {x: 50, y: 50, width: width - 100, height: (height - 150) / 2},
        {x: 50, y: (height - 100) / 2 + 50, width: (width - 75) / 2, height: (height - 150) / 2 - 50},
        {x: (width + 25) / 2, y: (height - 100) / 2 + 50, width: (width - 75) / 2, height: (height - 150) / 2 - 50},
        {x: 50, y: height - (height - 150) / 2 - 50, width: width - 100, height: (height - 150) / 2 - 100}
    ];
    updateCanvas();
    renderPositionsList();
}

function initDragHandlers() {
    const canvas = document.getElementById('frameCanvas');
    
    canvas.addEventListener('mousedown', function(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        
        const mouseX = (e.clientX - rect.left) * scaleX;
        const mouseY = (e.clientY - rect.top) * scaleY;
        
        // ‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏´‡∏ô
        for (let i = 0; i < photoPositions.length; i++) {
            const pos = photoPositions[i];
            if (mouseX >= pos.x && mouseX <= pos.x + pos.width &&
                mouseY >= pos.y && mouseY <= pos.y + pos.height) {
                isDragging = true;
                currentDragIndex = i;
                dragStartX = mouseX - pos.x;
                dragStartY = mouseY - pos.y;
                canvas.style.cursor = 'grabbing';
                break;
            }
        }
    });
    
    canvas.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        
        const mouseX = (e.clientX - rect.left) * scaleX;
        const mouseY = (e.clientY - rect.top) * scaleY;
        
        let newX = mouseX - dragStartX;
        let newY = mouseY - dragStartY;
        
        // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏ô‡∏≠‡∏Å Canvas
        newX = Math.max(0, Math.min(newX, canvas.width - photoPositions[currentDragIndex].width));
        newY = Math.max(0, Math.min(newY, canvas.height - photoPositions[currentDragIndex].height));
        
        photoPositions[currentDragIndex].x = Math.round(newX);
        photoPositions[currentDragIndex].y = Math.round(newY);
        
        updateCanvas();
        renderPositionsList();
    });
    
    canvas.addEventListener('mouseup', function() {
        isDragging = false;
        canvas.style.cursor = 'default';
    });
    
    canvas.addEventListener('mouseleave', function() {
        isDragging = false;
        canvas.style.cursor = 'default';
    });
}

async function saveFrameTemplate() {
    const name = document.getElementById('frameName').value;
    if (!name) {
        showMessage('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏ö', 'error');
        return;
    }
    
    const orientation = document.getElementById('frameOrientation').value;
    const width = parseInt(document.getElementById('canvasWidth').value);
    const height = parseInt(document.getElementById('canvasHeight').value);
    
    if (isNaN(width) || isNaN(height) || width < 100 || height < 100) {
        showMessage('‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î Canvas ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        return;
    }
    
    // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô base64
    let frameImageBase64 = null;
    if (currentFrameImage) {
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(currentFrameImage, 0, 0, width, height);
        frameImageBase64 = canvas.toDataURL('image/png');
    }
    
    const templateData = {
        name: name,
        orientation: orientation,
        canvas_width: width,
        canvas_height: height,
        photo_positions: photoPositions,
        frame_image: frameImageBase64
    };
    
    try {
        const response = await fetch('/api/frame_templates', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(templateData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showMessage('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            closeFrameBuilder();
            loadFrames();
        } else {
            showMessage('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (data.error || 'Unknown error'), 'error');
        }
    } catch (error) {
        console.error('Save error:', error);
        showMessage('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ', 'error');
    }
}

async function loadFrames() {
    try {
        const response = await fetch('/api/frame_templates');
        const data = await response.json();
        
        const container = document.getElementById('framesGrid');
        container.innerHTML = '';
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡πÉ‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        document.getElementById('frameCount').textContent = data.templates ? data.templates.length : 0;
        
        if (data.templates && data.templates.length > 0) {
            data.templates.forEach(template => {
                const card = document.createElement('div');
                card.className = 'frame-card';
                
                let previewHTML = '<i class="fas fa-border-all"></i>';
                if (template.frame_image_id) {
                    previewHTML = `<img src="/frame/${template.frame_image_id}" alt="${template.name}">`;
                }
                
                card.innerHTML = `
                    <div class="frame-card-preview">
                        ${previewHTML}
                    </div>
                    <h4>${template.name}</h4>
                    <div class="frame-card-info">
                        ${template.orientation === 'vertical' ? 'üì± ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á' : 'üì∫ ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô'}<br>
                        ${template.canvas_width} √ó ${template.canvas_height} px
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="deleteFrame('${template.id}')" class="btn btn-danger" style="flex: 1;">
                            <i class="fas fa-trash"></i> ‡∏•‡∏ö
                        </button>
                        <button onclick="viewFrameDetails('${template.id}')" class="btn btn-secondary" style="flex: 1;">
                            <i class="fas fa-info-circle"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        } else {
            container.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><i class="fas fa-border-all fa-3x"></i><h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ</h3><p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p></div>';
        }
    } catch (error) {
        console.error('Load frames error:', error);
        document.getElementById('framesGrid').innerHTML = '<div class="empty-state" style="grid-column: 1/-1; color: #f56565;"><i class="fas fa-exclamation-triangle fa-3x"></i><h3>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏ö</h3><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p></div>';
    }
}

async function deleteFrame(templateId) {
    if (!confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) return;
    
    try {
        const response = await fetch(`/api/frame_templates/${templateId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        if (data.success) {
            showMessage('‚úÖ ‡∏•‡∏ö‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            loadFrames();
        } else {
            showMessage('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ: ' + (data.error || 'Unknown error'), 'error');
        }
    } catch (error) {
        console.error('Delete error:', error);
        showMessage('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ', 'error');
    }
}

function viewFrameDetails(templateId) {
    fetch('/api/frame_templates')
        .then(response => response.json())
        .then(data => {
            const template = data.templates.find(t => t.id === templateId);
            if (template) {
                let details = `
                    <div style="text-align: center;">
                        <h3 style="color: #2d3748; margin-bottom: 20px;">${template.name}</h3>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <p><strong>üÜî ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏£‡∏≠‡∏ö:</strong> ${template.id}</p>
                            <p><strong>üì± ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á:</strong> ${template.orientation === 'vertical' ? '‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á' : '‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô'}</p>
                            <p><strong>üìè ‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${template.canvas_width} √ó ${template.canvas_height} px</p>
                            <p><strong>üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏Å‡∏£‡∏≠‡∏ö:</strong> ${template.frame_image_id ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</p>
                            <p><strong>‚è∞ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${template.created_at ? new Date(template.created_at).toLocaleString('th-TH') : 'N/A'}</p>
                        </div>
                        <button onclick="closeModal()" class="btn btn-primary">‡∏õ‡∏¥‡∏î</button>
                    </div>
                `;
                showModal('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏£‡∏≠‡∏ö', details);
            }
        });
}

// ============================================
// Memory Status Function
// ============================================
function checkMemoryStatus() {
    fetch('/api/memory_status')
        .then(response => response.json())
        .then(data => {
            let content = `
                <div style="text-align: center;">
                    <h3 style="color: #2d3748; margin-bottom: 20px;">üíæ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ RAM</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                        <p><strong>üì∏ ‡∏£‡∏π‡∏õ‡πÉ‡∏ô RAM:</strong> ${data.total_files} ‡πÑ‡∏ü‡∏•‡πå</p>
                        <p><strong>üíø ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${data.total_mb} MB</p>
                    </div>
                    <div style="margin-top: 20px; max-height: 200px; overflow-y: auto; text-align: left;">
                        <h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå:</h4>
                        <ul style="list-style: none; padding: 0;">
                            ${data.filenames.map(f => `<li style="padding: 5px; border-bottom: 1px solid #e2e8f0; font-size: 0.85rem;">${f}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            showModal('‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ RAM', content);
        })
        .catch(error => {
            showMessage('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ RAM ‡πÑ‡∏î‡πâ', 'error');
            console.error(error);
        });
}

// ============================================
// Utility Functions (Enhanced)
// ============================================
function showMessage(text, type = 'info') {
    const message = document.createElement('div');
    message.className = `message message-${type}`;
    message.innerHTML = text;
    
    document.body.appendChild(message);
    
    setTimeout(() => {
        message.style.opacity = '0';
        setTimeout(() => message.remove(), 500);
    }, 3000);
}

function showModal(title, content) {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = content;
    document.getElementById('infoModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('infoModal').style.display = 'none';
}

function copyCode(code) {
    navigator.clipboard.writeText(code).then(() => {
        showMessage(`‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ ${code} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
    });
}

// ============================================
// Time Functions
// ============================================
function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('th-TH');
    const dateStr = now.toLocaleDateString('th-TH', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    document.getElementById('currentTime').textContent = timeStr;
    document.getElementById('serverTime').textContent = `${dateStr} ${timeStr}`;
}

// ============================================
// Camera Control Functions
// ============================================
function unlockCamera() {
    if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ?')) {
        fetch('/api/unlock_camera', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('‚úÖ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    setTimeout(() => location.reload(), 1500);
                }
            });
    }
}

function forceUnlock() {
    emergencyUnlock();
}

function emergencyUnlock() {
    if (confirm('‚ö†Ô∏è EMERGENCY UNLOCK ‚ö†Ô∏è\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏£‡∏∞‡∏ö‡∏ö‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        fetch('/api/emergency_unlock', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('‚úÖ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    setTimeout(() => location.reload(), 2000);
                }
            })
            .catch(() => {
                showMessage('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÑ‡∏î‡πâ', 'error');
            });
    }
}

function clearQR() {
    if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á QR ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î?')) {
        fetch('/api/clear_qr', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('‚úÖ ‡∏•‡πâ‡∏≤‡∏á QR ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    setTimeout(() => location.reload(), 1500);
                }
            });
    }
}

function viewQR(code) {
    window.open(`/scan/${code}`, '_blank');
}

function downloadPhotoZip(code) {
    window.open(`/api/download_all/${code}`, '_blank');
}

function deletePhoto(photoId) {
    if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ?\n‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
        fetch(`/api/delete_photo/${photoId}`, { method: 'DELETE' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('‚úÖ ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                    setTimeout(() => location.reload(), 1500);
                }
            });
    }
}

function clearAllPhotos() {
    if (confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥!\n‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!')) {
        if (prompt('‡∏û‡∏¥‡∏°‡∏û‡πå "DELETE ALL PHOTOS" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô:') === 'DELETE ALL PHOTOS') {
            fetch('/api/clear_all_photos', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage('‚úÖ ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                        setTimeout(() => location.reload(), 2000);
                    }
                });
        }
    }
}

// ============================================
// Quick Actions
// ============================================
function quickUnlock() { unlockCamera(); }
function quickClearQR() { clearQR(); }
function quickRefresh() { location.reload(); }
function quickStats() { location.reload(); }
function quickBackup() { 
    showMessage('üì• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Backup...', 'info');
    window.open('/api/admin_data', '_blank');
}
function quickTest() {
    showModal('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö', `
        <div style="text-align: center;">
            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong></p>
            <button onclick="systemDiagnostic()" class="btn btn-primary" style="margin: 10px;">‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏£‡∏∞‡∏ö‡∏ö</button>
            <button onclick="checkMemoryStatus()" class="btn btn-secondary" style="margin: 10px;">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö RAM</button>
        </div>
    `);
}

// ============================================
// Initialize
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
    updateTime();
    setInterval(updateTime, 1000);
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏ö
    loadFrames();
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    setInterval(() => {
        fetch('/api/camera_status')
            .then(response => response.json())
            .then(data => {
                const statusEl = document.getElementById('cameraStatusLive');
                if (data.camera_locked) {
                    statusEl.className = 'status-indicator locked';
                    statusEl.innerHTML = '<i class="fas fa-lock"></i> ‡∏•‡πá‡∏≠‡∏Ñ';
                } else {
                    statusEl.className = 'status-indicator unlocked';
                    statusEl.innerHTML = '<i class="fas fa-unlock"></i> ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ';
                }
            });
    }, 10000);
    
    // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ô‡∏≠‡∏Å
    window.onclick = function(event) {
        const modal = document.getElementById('infoModal');
        const frameModal = document.getElementById('frameBuilderModal');
        if (event.target == modal) {
            closeModal();
        }
        if (event.target == frameModal) {
            closeFrameBuilder();
        }
    };
});
</script>
{% endblock %}
